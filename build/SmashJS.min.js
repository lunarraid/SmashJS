var SmashJS=SmashJS||{};SmashJS.util={},SmashJS.util.Map=function(){this.keys=[],this.values=[]},SmashJS.util.Map.prototype.constructor=SmashJS.util.Map,SmashJS.util.Map.prototype.put=function(t,e){var i=this.keys.indexOf(t);-1===i?(this.keys.push(t),this.values.push(e)):this.values[i]=e},SmashJS.util.Map.prototype.get=function(t){var e=this.keys.indexOf(t);return-1!==e?this.values[e]:null},SmashJS.util.Map.prototype.remove=function(t){var e=this.keys.indexOf(t);if(-1!==e){var i=this.keys.pop(),n=this.values.pop();e!==this.keys.length&&(this.keys[e]=i,this.values[e]=n)}},SmashJS.util.Map.prototype.getKeyAt=function(t){return this.keys[t]},SmashJS.util.Map.prototype.getValueAt=function(t){return this.values[t]},SmashJS.util.Map.prototype.removeAll=function(){this.keys.length=0,this.values.length=0},Object.defineProperty(SmashJS.util.Map.prototype,"length",{get:function(){return this.keys.length}}),SmashJS.util.SimplePriorityQueue=function(t){this._size=t+1,this._heap=new Array(this._size),this._posLookup=new SmashJS.util.Map,this._count=0},SmashJS.util.SimplePriorityQueue.prototype.constructor=SmashJS.util.SimplePriorityQueue,SmashJS.util.SimplePriorityQueue.prototype.enqueue=function(t){return this._count+1<this._size?(this._count++,this._heap[this._count]=t,this._posLookup.put(t,this._count),this.walkUp(this._count),!0):!1},SmashJS.util.SimplePriorityQueue.prototype.dequeue=function(){if(this._count>=1){var t=this._heap[1];return this._posLookup.remove(t),this._heap[1]=this._heap[this._count],this.walkDown(1),this._heap[this._count]=null,this._count--,t}return null},SmashJS.util.SimplePriorityQueue.prototype.reprioritize=function(t,e){if(!this._posLookup.get(t))return!1;var i=t.priority;t.priority=e;var n=this._posLookup.get(t);return e>i?this.walkUp(n):this.walkDown(n),!0},SmashJS.util.SimplePriorityQueue.prototype.remove=function(t){if(this._count>=1){var e=this._posLookup.get(t),i=this._heap[e];return this._posLookup.remove(i),this._heap[e]=this._heap[this._count],this.walkDown(e),this._heap[this._count]=null,this._posLookup.remove(this._count),this._count--,!0}return!1},SmashJS.util.SimplePriorityQueue.prototype.contains=function(t){return null!==this._posLookup.get(t)},SmashJS.util.SimplePriorityQueue.prototype.clear=function(){this._heap=new Array(this._size),this._posLookup=new Map,this._count=0},SmashJS.util.SimplePriorityQueue.prototype.isEmpty=function(){return 0===this._count},SmashJS.util.SimplePriorityQueue.prototype.toArray=function(){return this._heap.slice(1,this._count+1)},SmashJS.util.SimplePriorityQueue.prototype.toString=function(){return"[SimplePriorityQueue, size="+_size+"]"},SmashJS.util.SimplePriorityQueue.prototype.dump=function(){if(0===this._count)return"SimplePriorityQueue (empty)";for(var t="SimplePriorityQueue\n{\n",e=this._count+1,i=1;e>i;i++)t+="	"+this._heap[i]+"\n";return t+="\n}"},SmashJS.util.SimplePriorityQueue.prototype.walkUp=function(t){for(var e,i=t>>1,n=this._heap[t],o=n.priority;i>0&&(e=this._heap[i],o-e.priority>0);)this._heap[t]=e,this._posLookup.put(e,t),t=i,i>>=1;this._heap[t]=n,this._posLookup.put(n,t)},SmashJS.util.SimplePriorityQueue.prototype.walkDown=function(t){for(var e,i=t<<1,n=this._heap[t],o=n.priority;i<this._count&&(i<this._count-1&&this._heap[i].priority-this._heap[i+1].priority<0&&i++,e=this._heap[i],o-e.priority<0);)this._heap[t]=e,this._posLookup.put(e,t),this._posLookup.put(n,i),t=i,i<<=1;this._heap[t]=n,this._posLookup.put(n,t)},Object.defineProperty(SmashJS.util.SimplePriorityQueue.prototype,"front",{get:function(){return this._heap[1]}}),Object.defineProperty(SmashJS.util.SimplePriorityQueue.prototype,"maxSize",{get:function(){return this._size}}),Object.defineProperty(SmashJS.util.SimplePriorityQueue.prototype,"size",{get:function(){return this._count}}),SmashJS.BaseObject=function(t){this._active=!1,this._owningGroup=null,this._sets=[],this._name=t||""},SmashJS.BaseObject.prototype.isBaseObject=!0,SmashJS.BaseObject.prototype.noteSetAdd=function(t){this._sets.push(t)},SmashJS.BaseObject.prototype.noteSetRemove=function(t){var e=this._sets.indexOf(t);if(-1==e)throw new Error("Tried to remove BaseObject from a GameSet it didn't know it was in!");this._sets.splice(e,1)},SmashJS.BaseObject.prototype.initialize=function(){if(null===this._owningGroup)throw new Error("Can't initialize a BaseObject without an owning GameGroup!");this._active=!0},SmashJS.BaseObject.prototype.destroy=function(){for(;this._sets.length>0;)this._sets[this._sets.length-1].remove(this);this._owningGroup&&(this._owningGroup.noteRemove(this),this._owningGroup=null),this._active=!1},SmashJS.BaseObject.prototype.constructor=SmashJS.BaseObject,Object.defineProperty(SmashJS.BaseObject.prototype,"name",{get:function(){return this._name},set:function(t){if(this._active&&this._owningGroup)throw new Error("Cannot change BaseObject name after initialize() is called and while in a GameGroup.");this._name=t}}),Object.defineProperty(SmashJS.BaseObject.prototype,"sets",{get:function(){return this._sets}}),Object.defineProperty(SmashJS.BaseObject.prototype,"owningGroup",{get:function(){return this._owningGroup},set:function(t){if(!t)throw new Error("A BaseObject must always be in a GameGroup.");this._owningGroup&&this._owningGroup.noteRemove(this),this._owningGroup=t,this._owningGroup.noteAdd(this)}}),SmashJS.GameObject=function(t){SmashJS.BaseObject.call(this,t),this.broadcast=new SmashJS.Signal,this._deferring=!0,this._components={}},SmashJS.GameObject.prototype=Object.create(SmashJS.BaseObject.prototype),SmashJS.GameObject.prototype.constructor=SmashJS.GameObject,SmashJS.GameObject.prototype.doInitialize=function(t){t._owner=this,t.doAdd()},SmashJS.GameObject.prototype.addComponent=function(t,e){if(e&&(t.name=e),!t.name)throw"Can't add component with no name.";return this._components[t.name]=t,t._owner=this,void 0===this[t.name]&&(this[t.name]=t),this._deferring?this._components["!"+t.name]=t:this.doInitialize(t),t},SmashJS.GameObject.prototype.removeComponent=function(t){if(t.owner!==this)throw"Tried to remove a component that does not belong to this GameGameObject.";this[t.name]===t&&(this[t.name]=null),this._components[t.name]=null,delete this._components[t.name],t.doRemove(),t._owner=null},SmashJS.GameObject.prototype.lookupComponent=function(t){return this._components[t]},SmashJS.GameObject.prototype.getAllComponents=function(){var t=[];for(var e in this._components)t.push(this._components[e]);return t},SmashJS.GameObject.prototype.initialize=function(){SmashJS.BaseObject.prototype.initialize.call(this);for(var t in this){var e=this[t];if(e&&e.isGameComponent&&null===e.owner){if(e.name&&e.name!==t)throw new Error("GameComponent has name '"+e.name+"' but is set into field named '"+t+"', these need to match!");e.name=t,this.addComponent(e)}}this.deferring=!1;for(var i in this._components){if(!this._components[i].propertyManager)throw new Error("Failed to inject component properly.");this._components[i].applyBindings()}},SmashJS.GameObject.prototype.destroy=function(){for(var t in this._components)this.removeComponent(this._components[t]);this.broadcast.removeAll(),SmashJS.BaseObject.prototype.destroy.call(this)},SmashJS.GameObject.prototype.getManager=function(t){return this.owningGroup.getManager(t)},SmashJS.GameObject.prototype.getProperty=function(t,e){return this.getManager(SmashJS.PropertyManager).getProperty(this,t,e)},SmashJS.GameObject.prototype.setProperty=function(t,e){this.getManager(SmashJS.PropertyManager).setProperty(this,t,e)},Object.defineProperty(SmashJS.GameObject.prototype,"deferring",{get:function(){return this._deferring},set:function(t){if(this._deferring&&t===!1)for(var e=!0;e;){e=!1;for(var i in this._components)"!"===i.charAt(0)&&(this.doInitialize(this._components[i]),this._components[i]=null,delete this._components[i],e=!0)}this._deferring=t}}),SmashJS.GameGroup=function(){SmashJS.BaseObject.call(this),this._items=[],this._managers=new SmashJS.util.Map},SmashJS.GameGroup.prototype=Object.create(SmashJS.BaseObject.prototype),SmashJS.GameGroup.prototype.constructor=SmashJS.GameGroup,SmashJS.GameGroup.prototype.contains=function(t){return t.owningGroup===this},SmashJS.GameGroup.prototype.getGameObjectAt=function(t){return this._items[t]},SmashJS.GameGroup.prototype.initialize=function(){},SmashJS.GameGroup.prototype.destroy=function(){for(SmashJS.BaseObject.prototype.destroy.call(this);this.length;)this.getGameObjectAt(this.length-1).destroy();for(var t=this._managers.length-1;t>=0;t--){var e=this._managers.getKeyAt(t),i=this._managers.getValueAt(t);i&&i.destroy&&i.destroy(),this._managers.remove(e)}},SmashJS.GameGroup.prototype.noteRemove=function(t){var e=this._items.indexOf(t);if(-1==e)throw new Error("Can't find GameObject in GameGroup! Inconsistent group membership!");this._items.splice(e,1)},SmashJS.GameGroup.prototype.noteAdd=function(t){this._items.push(t)},SmashJS.GameGroup.prototype.registerManager=function(t,e){return this._managers.put(t,e),e.owningGroup=this,e.initialize&&e.initialize(),e},SmashJS.GameGroup.prototype.getManager=function(t){var e=this._managers.get(t);if(!e){if(this.owningGroup)return this.owningGroup.getManager(t);throw new Error("Can't find manager "+t+"!")}return e},SmashJS.GameGroup.prototype.lookup=function(t){for(var e=0;e<this._items.length;e++)if(this._items[e].name===t)return this._items[e];return null},Object.defineProperty(SmashJS.GameGroup.prototype,"length",{get:function(){return this._items.length}}),SmashJS.GameSet=function(){SmashJS.BaseObject.call(this),this.items=[]},SmashJS.GameSet.prototype=Object.create(SmashJS.BaseObject.prototype),SmashJS.GameSet.prototype.constructor=SmashJS.GameSet,SmashJS.GameSet.prototype.add=function(t){this.items.push(t),t.noteSetAdd(this)},SmashJS.GameSet.prototype.remove=function(t){var e=this.items.indexOf(t);if(-1===e)throw"Requested GameObject is not in this GameSet.";this.items.splice(e,1),t.noteSetRemove(this)},SmashJS.GameSet.prototype.contains=function(t){return-1!==this.items.indexOf(t)},SmashJS.GameSet.prototype.getGameObjectAt=function(t){return this.items[t]},Object.defineProperty(SmashJS.GameSet.prototype,"length",{get:function(){return this.items.length}}),SmashJS.GameComponent=function(){this.bindings=[],this._safetyFlag=!1,this._name="",this._owner=null},SmashJS.GameComponent.prototype.isGameComponent=!0,SmashJS.GameComponent.prototype.addBinding=function(t,e){this.bindings.push(t+"||"+e)},SmashJS.GameComponent.prototype.removeBinding=function(t,e){var i=t+"||"+e,n=this.bindings.indexOf(i);-1!==n&&this.bindings.splice(n,1)},SmashJS.GameComponent.prototype.applyBindings=function(){if(!this.propertyManager)throw new Error("Couldn't find a PropertyManager instance");for(var t=0;t<this.bindings.length;t++)this.propertyManager.applyBinding(this,this.bindings[t])},SmashJS.GameComponent.prototype.doAdd=function(){if(this.propertyManager=this.owner.getManager(SmashJS.PropertyManager),this._safetyFlag=!1,this.onAdd(),this._safetyFlag===!1)throw new Error("You forget to call onAdd() on supr in an onAdd override.")},SmashJS.GameComponent.prototype.doRemove=function(){if(this._safetyFlag=!1,this.onRemove(),this._safetyFlag===!1)throw new Error("You forget to call onRemove() on supr in an onRemove handler.")},SmashJS.GameComponent.prototype.onAdd=function(){this._safetyFlag=!0},SmashJS.GameComponent.prototype.onRemove=function(){this._safetyFlag=!0},SmashJS.GameComponent.prototype.constructor=SmashJS.GameComponent,Object.defineProperty(SmashJS.GameComponent.prototype,"name",{get:function(){return this._name},set:function(t){if(this._owner)throw new Error("Already added to GameObject, can't change name of GameComponent.");this._name=t}}),Object.defineProperty(SmashJS.GameComponent.prototype,"owner",{get:function(){return this._owner}}),SmashJS.Signal=function(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){SmashJS.Signal.prototype.dispatch.apply(t,arguments)}},SmashJS.Signal.prototype={VERSION:"::VERSION_NUMBER::",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,i,n){var o,r=this._indexOfListener(t,i);if(-1!==r){if(o=this._bindings[r],o.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else o=new SmashJS.SignalBinding(this,t,e,i,n),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var i,n=this._bindings.length;n--;)if(i=this._bindings[n],i._listener===t&&i.context===e)return n;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){return this.validateListener(t,"add"),this._registerListener(t,!1,e,i)},addOnce:function(t,e,i){return this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(t){if(this.active){var e,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=i),n){e=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(e[n]&&this._shouldPropagate&&e[n].execute(i)!==!1)}}},validateListener:function(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},SmashJS.SignalBinding=function(t,e,i,n,o){this._listener=e,this._isOnce=i,this.context=n,this._signal=t,this._priority=o||0},SmashJS.SignalBinding.prototype={active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},SmashJS.Property=SmashJS.Property||{},SmashJS.Property.ComponentPlugin=function(){this.fieldResolver=new SmashJS.Property.FieldPlugin},SmashJS.Property.ComponentPlugin.prototype.resolve=function(t,e,i){var n;if(t.isBaseObject)n=t;else{if(!t.isGameComponent)throw"Can't find entity to do lookup!";n=t.owner}var o=n.lookupComponent(e[1]);e.length>2?this.fieldResolver.resolveFull(o,e,i,2):(i.object=o,i.field=null)},SmashJS.Property.ComponentPlugin.prototype.constructor=SmashJS.Property.ComponentPlugin,SmashJS.Property.FieldPlugin=function(){},SmashJS.Property.FieldPlugin.prototype.resolve=function(t,e,i){for(var n=t,o=0;o<e.length-1;o++)n=n[e[o]];i.object=n,i.field=e[e.length-1]},SmashJS.Property.FieldPlugin.prototype.resolveFull=function(t,e,i,n){void 0===n&&(n=0);for(var o=t,r=n;r<e.length-1;r++)o=o[e[r]];i.object=o,i.field=e[e.length-1]},SmashJS.Property.FieldPlugin.prototype.constructor=SmashJS.Property.FieldPlugin,SmashJS.Property.PropertyInfo=function(){this.object=null,this.field=null},SmashJS.Property.PropertyInfo.prototype.constructor=SmashJS.Property.PropertyInfo,SmashJS.Property.PropertyInfo.prototype.getValue=function(){return this.field?this.object[this.field]:this.object},SmashJS.Property.PropertyInfo.prototype.setValue=function(t){this.object[this.field]=t},SmashJS.Property.PropertyInfo.prototype.clear=function(){this.object=null,this.field=null},SmashJS.PropertyManager=function(){this.propertyPlugins={},this.parseCache={},this.cachedPi=new SmashJS.Property.PropertyInfo,this.bindingCache={},this.registerPropertyType("@",new SmashJS.Property.ComponentPlugin)},SmashJS.PropertyManager.prototype.constructor=SmashJS.PropertyManager,SmashJS.PropertyManager.prototype.registerPropertyType=function(t,e){this.propertyPlugins[t]=e},SmashJS.PropertyManager.prototype.findProperty=function(t,e,i){if(null===e||0===e.length)return null;this.parseCache[e]||(this.parseCache[e]=[e.charAt(0)].concat(e.substr(1).split(".")));var n=this.parseCache[e],o=this.propertyPlugins[n[0]];if(!o)throw"Unknown prefix '"+n[0]+"' in '"+e+"'.";return o.resolve(t,n,i),i},SmashJS.PropertyManager.prototype.applyBinding=function(t,e){this.bindingCache[e]||(this.bindingCache[e]=e.split("||"));var i=this.bindingCache[e],n=this.findProperty(t,i[1],this.cachedPi).getValue();t[i[0]]!==n&&(t[i[0]]=n)},SmashJS.PropertyManager.prototype.getProperty=function(t,e,i){var n=this.findProperty(t,e,this.cachedPi);return n?n.getValue():i},SmashJS.PropertyManager.prototype.setProperty=function(t,e,i){var n=this.findProperty(t,e,this.cachedPi);null!==n&&n.setValue(i)};var TICKS_PER_SECOND=60,TICK_RATE=1/TICKS_PER_SECOND,TICK_RATE_MS=1e3*TICK_RATE,MAX_TICKS_PER_FRAME=5,ScheduleEntry=function(){this.dueTime=0,this.thisObject=null,this.callback=null,this.arguments=null};Object.defineProperty(ScheduleEntry.prototype,"priority",{get:function(){return-dueTime},set:function(t){throw"Unimplemented"}}),SmashJS.TimeManager=function(){this.deferredMethodQueue=[],this._virtualTime=0,this._interpolationFactor=0,this.timeScale=1,this.lastTime=-1,this.elapsed=0,this.animatedObjects=[],this.tickedObjects=[],this.needPurgeEmpty=!1,this._platformTime=0,this._frameCounter=0,this.duringAdvance=!1,this.thinkHeap=new SmashJS.util.SimplePriorityQueue(4096),this.disableSlowWarning=!0,this.timeScale=1},SmashJS.TimeManager.prototype.constructor=SmashJS.TimeManager,SmashJS.TimeManager.prototype.initialize=function(){this.started||this.start()},SmashJS.TimeManager.prototype.destroy=function(){this.started&&stop()},SmashJS.TimeManager.prototype.start=function(){this.started||(this.lastTime=-1,this.elapsed=0,this.started=!0)},SmashJS.TimeManager.prototype.stop=function(){this.started&&(this.started=!1)},SmashJS.TimeManager.prototype.schedule=function(t,e,i){var n=Array.prototype.slice.call(arguments,3);this.started||this.start();var o=new ScheduleEntry;o.dueTime=this._virtualTime+t,o.thisObject=e,o.callback=i,o.arguments=n,this.thinkHeap.enqueue(o)},SmashJS.TimeManager.prototype.addAnimatedObject=function(t,e){void 0===e&&(e=0),this.addObject(t,e,this.animatedObjects)},SmashJS.TimeManager.prototype.addTickedObject=function(t,e){void 0===e&&(e=0),this.addObject(t,e,this.tickedObjects)},SmashJS.TimeManager.prototype.queueObject=function(t){if(t.nextThinkTime<this._virtualTime)throw new Error("Tried to queue something into the past, but no flux capacitor is present!");this.thinkHeap.contains(t)&&this.thinkHeap.remove(t),!this.thinkHeap.enqueue(t)},SmashJS.TimeManager.prototype.dequeueObject=function(t){this.thinkHeap.contains(t)&&this.thinkHeap.remove(t)},SmashJS.TimeManager.prototype.removeAnimatedObject=function(t){this.removeObject(t,this.animatedObjects)},SmashJS.TimeManager.prototype.removeTickedObject=function(t){this.removeObject(t,this.tickedObjects)},SmashJS.TimeManager.prototype.callLater=function(t,e){var i=Array.prototype.slice.call(arguments,2),n={context:t,method:e,args:i};deferredMethodQueue.push(n)},SmashJS.TimeManager.prototype.addObject=function(t,e,i){if(this.duringAdvance)throw new Error("Unimplemented!");this.started||this.start();for(var n=-1,o=0;o<i.length;o++)if(i[o]){if(i[o].listener===t)return;if(i[o].priority<e){n=o;break}}var r={listener:t,priority:e};0>n||n>=i.length?i.push(r):i.splice(n,0,r)},SmashJS.TimeManager.prototype.removeObject=function(t,e){1==this.listenerCount&&0===this.thinkHeap.size&&this.stop();for(var i=0;i<e.length;i++)if(e[i]&&e[i].listener===t)return void(this.duringAdvance?(e[i]=null,this.needPurgeEmpty=!0):e.splice(i,1))},SmashJS.TimeManager.prototype.update=function(){if(this.started){var t=Date.now();if(this.lastTime<0)return void(this.lastTime=t);this._frameCounter++;var e=(t-this.lastTime)*this.timeScale;this.advance(e),this.lastTime=t}},SmashJS.TimeManager.prototype.advance=function(t,e){void 0===e&&(e=!1),this._platformTime=Date.now();this._virtualTime;this.elapsed+=t;for(var i=0;this.elapsed>=TICK_RATE_MS&&(e||MAX_TICKS_PER_FRAME>i);)this.fireTick(),this.tickCount++;this.tickCount>=MAX_TICKS_PER_FRAME&&!e&&!disableSlowWarning,this.elapsed=this.clamp(this.elapsed,0,300),this.duringAdvance=!0,this._interpolationFactor=this.elapsed/TICK_RATE_MS;for(var n=.001*t,o=0;o<this.animatedObjects.length;o++){var r=this.animatedObjects[o];r&&r.listener.onFrame(n)}if(this.duringAdvance=!1,this.needPurgeEmpty){this.needPurgeEmpty=!1;for(var s=0;s<this.animatedObjects.length;s++)this.animatedObjects[s]||(this.animatedObjects.splice(s,1),s--);for(var a=0;a<this.tickedObjects.length;a++)this.tickedObjects[a]||(this.tickedObjects.splice(a,1),a--)}},SmashJS.TimeManager.prototype.fireTick=function(){this._interpolationFactor=0,this.processScheduledObjects(),duringAdvance=!0;for(var t=0;t<this.tickedObjects.length;t++){var e=this.tickedObjects[t];e&&e.listener.onTick(TICK_RATE)}this.duringAdvance=!1,this._virtualTime+=TICK_RATE_MS,this.elapsed-=TICK_RATE_MS},SmashJS.TimeManager.prototype.processScheduledObjects=function(){var t=this.deferredMethodQueue;if(t.length>0){this.deferredMethodQueue=[];for(var e=0;e<t.length;e++){var i=t[e];i.method.apply(i.context,i.args)}t.length=0}if(this.thinkHeap.size>0)for(;this.thinkHeap.size>0&&this.thinkHeap.front.priority>=-this._virtualTime;){var n=this.thinkHeap.dequeue();if(n.nextThinkTime)n.nextThinkCallback&&n.nextThinkCallback.call(n.nextThinkContext);else{if(!n.callback)throw"Unknown type found in thinkHeap.";n.callback.apply(n.thisObject,n.arguments)}}},SmashJS.TimeManager.prototype.clamp=function(t,e,i){return e=e||0,i=i||0,e>t?e:t>i?i:t},Object.defineProperty(SmashJS.TimeManager.prototype,"isTicking",{get:function(){return this.started}}),Object.defineProperty(SmashJS.TimeManager.prototype,"interpolationFactor",{get:function(){return this._interpolationFactor}}),Object.defineProperty(SmashJS.TimeManager.prototype,"virtualTime",{get:function(){return this._virtualTime}}),Object.defineProperty(SmashJS.TimeManager.prototype,"platformTime",{get:function(){return this._platformTime}}),Object.defineProperty(SmashJS.TimeManager.prototype,"frameCounter",{get:function(){return this._frameCounter}}),Object.defineProperty(SmashJS.TimeManager.prototype,"msPerTick",{get:function(){return TICK_RATE_MS}}),Object.defineProperty(SmashJS.TimeManager.prototype,"listenerCount",{get:function(){return this.tickedObjects.length+this.animatedObjects.length}}),SmashJS.TickedComponent=function(){SmashJS.GameComponent.call(this),this.updatePriority=0,this._registerForUpdates=!0,this._isRegisteredForUpdates=!1},SmashJS.TickedComponent.prototype=Object.create(SmashJS.GameComponent.prototype),SmashJS.TickedComponent.prototype.constructor=SmashJS.TickedComponent,SmashJS.TickedComponent.prototype.onTick=function(t){this.applyBindings()},SmashJS.TickedComponent.prototype.onAdd=function(){SmashJS.GameComponent.prototype.onAdd.call(this),this.timeManager=this.owner.getManager(SmashJS.TimeManager),this.registerForTicks=this.registerForTicks},SmashJS.TickedComponent.prototype.onRemove=function(){this.registerTicks=!1,SmashJS.GameComponent.prototype.onRemove.call(this)},Object.defineProperty(SmashJS.TickedComponent.prototype,"registerForTicks",{get:function(){return this._registerForUpdates},set:function(t){this._registerForUpdates=t,this.timeManager&&(this._registerForUpdates&&!this._isRegisteredForUpdates?(this._isRegisteredForUpdates=!0,this.timeManager.addTickedObject(this,this.updatePriority)):!this._registerForUpdates&&this._isRegisteredForUpdates&&(this._isRegisteredForUpdates=!1,this.timeManager.removeTickedObject(this)))}}),SmashJS.AnimatedComponent=function(){SmashJS.GameComponent.call(this),this.updatePriority=0,this._registerForUpdates=!0,this._isRegisteredForUpdates=!1},SmashJS.AnimatedComponent.prototype=Object.create(SmashJS.GameComponent.prototype),SmashJS.AnimatedComponent.prototype.constructor=SmashJS.AnimatedComponent,SmashJS.AnimatedComponent.prototype.onFrame=function(){this.applyBindings()},SmashJS.AnimatedComponent.prototype.onAdd=function(){SmashJS.GameComponent.prototype.onAdd.call(this),this.timeManager=this.owner.getManager(SmashJS.TimeManager),this.registerForUpdates=this.registerForUpdates},SmashJS.AnimatedComponent.prototype.onRemove=function(){this.registerForUpdates=!1,SmashJS.GameComponent.prototype.onRemove.call(this)},Object.defineProperty(SmashJS.AnimatedComponent.prototype,"registerForUpdates",{get:function(){return this._registerForUpdates},set:function(t){this._registerForUpdates=t,this.timeManager&&(this._registerForUpdates&&!this._isRegisteredForUpdates?(this._isRegisteredForUpdates=!0,this.timeManager.addAnimatedObject(this,this.updatePriority)):!this._registerForUpdates&&this._isRegisteredForUpdates&&(this._isRegisteredForUpdates=!1,this.timeManager.removeAnimatedObject(this)))}}),SmashJS.QueuedComponent=function(){SmashJS.GameComponent.call(this)},SmashJS.QueuedComponent.prototype=Object.create(SmashJS.GameComponent.prototype),SmashJS.QueuedComponent.prototype.constructor=SmashJS.QueuedComponent,SmashJS.QueuedComponent.prototype.think=function(t,e,i){this.nextThinkContext=t,this.nextThinkTime=this.timeManager.virtualTime+i,this.nextThinkCallback=e,this.timeManager.queueObject(this)},SmashJS.QueuedComponent.prototype.unthink=function(){this.timeManager.dequeueObject(this)},SmashJS.QueuedComponent.prototype.onAdd=function(){SmashJS.GameComponent.prototype.onAdd.call(this),this.timeManager=this.owner.getManager(SmashJS.TimeManager),this.nextThinkContext=null,this.nextThinkCallback=null},SmashJS.QueuedComponent.prototype.onRemove=function(){SmashJS.GameComponent.prototype.onRemove.call(this),this.nextThinkContext=null,this.nextThinkCallback=null},Object.defineProperty(SmashJS.QueuedComponent.prototype,"priority",{get:function(){return-this.nextThinkTime}});